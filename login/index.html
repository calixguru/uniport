<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NSChE UNIPORT – Login</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Baloo Font -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>body { font-family: 'Baloo 2', cursive; }</style>
</head>

<body class="bg-gradient-to-br from-green-50 to-green-100 min-h-screen flex justify-center items-center px-6">

  <div class="bg-white shadow-2xl rounded-3xl p-10 max-w-md w-full border border-green-200">

    <!-- Logo -->
    <div class="text-center mb-6">
      <img src="https://www.nsche.org/img/apple-touch-icon.png" class="w-28 mx-auto">
      <h2 class="text-3xl mt-3 font-extrabold text-green-800 uppercase">Member Login</h2>
      <p class="text-green-600 text-md">Access your NSChE Uniport Portal</p>
    </div>

    <!-- Input -->
    <label class="block text-green-800 font-semibold mb-2">Registration Code</label>
    <input id="code"
           class="w-full px-4 py-3 rounded-xl border border-green-300 focus:ring-2 focus:ring-green-500 focus:outline-none text-green-900 mb-6"
           placeholder="Enter your registration code">

    <!-- Login Button -->
    <button onclick="loginUser()"
            class="w-full py-3 bg-green-700 hover:bg-green-800 text-white font-semibold rounded-xl shadow-md transition">
      Login
    </button>

    <!-- Back to Home -->
    <div class="text-center mt-6">
      <a href="../" class="text-green-700 hover:underline">← Back to Home</a>
    </div>

    <p class="text-center mt-6 text-green-700">
      Don't have an account?
      <a href="/register" class="text-green-800 underline font-bold">Register</a>
    </p>

  </div>

  <script>
    async function loginUser() {
      const code = document.getElementById("code").value.trim();

      if (!code) {
        Swal.fire({ icon: 'warning', title: 'Oops!', text: 'Please enter your registration code', timer: 3000 });
        return;
      }

      try {
        const res = await fetch("http://127.0.0.1:8000/login/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code })
        });

        const data = await res.json();

        if (res.ok && data.token && data.name) {
          localStorage.setItem("token", data.token);
          localStorage.setItem("name", data.name);

          Swal.fire({
            icon: 'success',
            title: 'Login Successful!',
            text: `Welcome back ${data.name}`,
            timer: 2000,
            showConfirmButton: false
          }).then(() => {
            window.location.href = "index.html";
          });

        } else {
          Swal.fire({ icon: 'error', title: 'Login Failed', text: data.error || 'Please try again', timer: 4000 });
        }
      } catch (err) {
        console.error(err);
        Swal.fire({ icon: 'error', title: 'Network Error', text: 'Check your connection or try again', timer: 4000 });
      }
    }
  </script>
</body>
</html>
